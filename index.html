<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Financi√´le Planning Tool</title>

  <!-- React + Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'primary': '#10b981',
            'primary-dark': '#059669',
            'secondary': '#3b82f6',
            'accent': '#f59e0b',
            'dark': '#1f2937',
            'light': '#f9fafb',
          }
        }
      }
    }
  </script>
</head>
<body class="bg-light">

<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

/* ================================
   UNIFIED FINANCIAL ENGINE
   ================================ */

// Tax Constants
const TAX_BRACKETS_2026 = [
  { limit: 38883, rate: 35.75 },
  { limit: 78426, rate: 37.56 },
  { limit: Infinity, rate: 49.5 }
];

const TAX_CREDITS_2026 = {
  algemeneMax: 3115,
  algemeneAfbouwStart: 29739,
  algemeneAfbouwPercentage: 6.398,
  arbeidMax: 5685,
  arbeidBuildRateLow: 8.324,
  arbeidLowThreshold: 11965,
  arbeidPhaseoutStart: 45592,
  arbeidPhaseoutRate: 6.51
};

// Toeslagen Constants (with inflation adjustment capability)
const TOESLAGEN_2026 = {
  KINDGEBONDEN_BUDGET: {
    PER_KIND: 2580,
    DREMPEL_ENKEL: 29736,
    DREMPEL_PARTNER: 39141,
    AFBOUW_PERC: 0.076,
    INFLATION_LAG: 1 // Toeslagen stijgen met 1 jaar vertraging
  },
  KINDERBIJSLAG: {
    LEEFTIJD_0_5: { kwartaal: 295.07 },
    LEEFTIJD_6_11: { kwartaal: 358.30 },
    LEEFTIJD_12_17: { kwartaal: 421.53 },
    INFLATION_LAG: 1
  },
  KINDEROPVANG: {
    MAX_UREN_MAAND: 230,
    TYPES: { dagopvang: 11.23, bso: 9.98, gastouder: 8.49 },
    INFLATION_LAG: 1
  }
};

const KINDEROPVANG_SCHIJVEN = [
  { van: 0, tot: 24149, percEerste: 0.960, percVolgend: 0.960 },
  { van: 24150, tot: 25756, percEerste: 0.960, percVolgend: 0.960 },
  { van: 25757, tot: 27363, percEerste: 0.960, percVolgend: 0.960 },
  { van: 27364, tot: 28973, percEerste: 0.960, percVolgend: 0.960 },
  { van: 28974, tot: 30579, percEerste: 0.960, percVolgend: 0.960 },
  { van: 30580, tot: 32189, percEerste: 0.960, percVolgend: 0.960 },
  { van: 32190, tot: 33795, percEerste: 0.960, percVolgend: 0.960 },
  { van: 33796, tot: 35400, percEerste: 0.960, percVolgend: 0.960 },
  { van: 35401, tot: 37129, percEerste: 0.960, percVolgend: 0.960 },
  { van: 37130, tot: 38855, percEerste: 0.960, percVolgend: 0.960 },
  { van: 38856, tot: 40586, percEerste: 0.960, percVolgend: 0.960 },
  { van: 40587, tot: 42313, percEerste: 0.960, percVolgend: 0.960 },
  { van: 42314, tot: 44046, percEerste: 0.960, percVolgend: 0.960 },
  { van: 44047, tot: 45776, percEerste: 0.960, percVolgend: 0.960 },
  { van: 45777, tot: 47546, percEerste: 0.960, percVolgend: 0.960 },
  { van: 47547, tot: 49318, percEerste: 0.960, percVolgend: 0.960 },
  { van: 49319, tot: 51092, percEerste: 0.960, percVolgend: 0.960 },
  { van: 51093, tot: 52864, percEerste: 0.960, percVolgend: 0.960 },
  { van: 52865, tot: 54641, percEerste: 0.960, percVolgend: 0.960 },
  { van: 54642, tot: 56412, percEerste: 0.960, percVolgend: 0.960 },
  { van: 56413, tot: 58184, percEerste: 0.955, percVolgend: 0.956 },
  { van: 58185, tot: 59957, percEerste: 0.948, percVolgend: 0.956 },
  { van: 59958, tot: 61895, percEerste: 0.939, percVolgend: 0.956 },
  { van: 61896, tot: 65695, percEerste: 0.924, percVolgend: 0.956 },
  { van: 65696, tot: 69492, percEerste: 0.916, percVolgend: 0.952 },
  { van: 69493, tot: 73292, percEerste: 0.905, percVolgend: 0.946 },
  { van: 73293, tot: 77094, percEerste: 0.882, percVolgend: 0.942 },
  { van: 77095, tot: 80891, percEerste: 0.859, percVolgend: 0.939 },
  { van: 80892, tot: 84693, percEerste: 0.837, percVolgend: 0.932 },
  { van: 84694, tot: 88491, percEerste: 0.812, percVolgend: 0.927 },
  { van: 88492, tot: 92291, percEerste: 0.789, percVolgend: 0.922 },
  { van: 92292, tot: 96091, percEerste: 0.767, percVolgend: 0.915 },
  { van: 96092, tot: 99889, percEerste: 0.743, percVolgend: 0.909 },
  { van: 99890, tot: 103694, percEerste: 0.721, percVolgend: 0.905 },
  { van: 103695, tot: 107492, percEerste: 0.696, percVolgend: 0.902 },
  { van: 107493, tot: 111290, percEerste: 0.673, percVolgend: 0.895 },
  { van: 111291, tot: 115090, percEerste: 0.651, percVolgend: 0.891 },
  { van: 115091, tot: 118963, percEerste: 0.627, percVolgend: 0.886 },
  { van: 118964, tot: 122857, percEerste: 0.606, percVolgend: 0.879 },
  { van: 122858, tot: 126747, percEerste: 0.585, percVolgend: 0.874 },
  { van: 126748, tot: 130638, percEerste: 0.564, percVolgend: 0.870 },
  { van: 130639, tot: 134527, percEerste: 0.542, percVolgend: 0.867 },
  { van: 134528, tot: 138420, percEerste: 0.523, percVolgend: 0.860 },
  { van: 138421, tot: 142312, percEerste: 0.504, percVolgend: 0.854 },
  { van: 142313, tot: 146205, percEerste: 0.485, percVolgend: 0.850 },
  { van: 146206, tot: 150092, percEerste: 0.465, percVolgend: 0.844 },
  { van: 150093, tot: 153982, percEerste: 0.445, percVolgend: 0.840 },
  { van: 153983, tot: 157877, percEerste: 0.425, percVolgend: 0.833 },
  { van: 157878, tot: 161766, percEerste: 0.405, percVolgend: 0.827 },
  { van: 161767, tot: 165657, percEerste: 0.385, percVolgend: 0.817 },
  { van: 165658, tot: 169547, percEerste: 0.365, percVolgend: 0.814 },
  { van: 169548, tot: 173440, percEerste: 0.365, percVolgend: 0.806 },
  { van: 173441, tot: 177335, percEerste: 0.365, percVolgend: 0.797 },
  { van: 177336, tot: 181223, percEerste: 0.365, percVolgend: 0.791 },
  { van: 181224, tot: 185114, percEerste: 0.365, percVolgend: 0.782 },
  { van: 185115, tot: 189002, percEerste: 0.365, percVolgend: 0.777 },
  { van: 189003, tot: 192896, percEerste: 0.365, percVolgend: 0.769 },
  { van: 192897, tot: 196789, percEerste: 0.365, percVolgend: 0.762 },
  { van: 196790, tot: 200681, percEerste: 0.365, percVolgend: 0.755 },
  { van: 200682, tot: 204571, percEerste: 0.365, percVolgend: 0.745 },
  { van: 204572, tot: 208458, percEerste: 0.365, percVolgend: 0.740 },
  { van: 208459, tot: 212353, percEerste: 0.365, percVolgend: 0.733 },
  { van: 212354, tot: 216242, percEerste: 0.365, percVolgend: 0.725 },
  { van: 216243, tot: 220134, percEerste: 0.365, percVolgend: 0.718 },
  { van: 220135, tot: 224026, percEerste: 0.365, percVolgend: 0.712 },
  { van: 224027, tot: 227915, percEerste: 0.365, percVolgend: 0.704 },
  { van: 227916, tot: 231807, percEerste: 0.365, percVolgend: 0.696 },
  { van: 231808, tot: 235697, percEerste: 0.365, percVolgend: 0.691 },
  { van: 235698, tot: Infinity, percEerste: 0.365, percVolgend: 0.682 }
];

// Helper Functions
const yearlyAmount = (amount, frequency) => frequency === 'monthly' ? amount * 12 : amount;
const isActiveInYear = (item, year) => year >= item.startYear && (!item.endYear || year <= item.endYear);
const grow = (value, rate, years) => {
  const safeYears = Math.max(0, years); // Prevent negative years
  return value * Math.pow(1 + rate / 100, safeYears);
};

// Tax Calculation
const calculateDutchTax2026 = (grossIncome) => {
  let tax = 0, remaining = grossIncome, previousLimit = 0;
  
  for (const bracket of TAX_BRACKETS_2026) {
    const bracketSize = Math.min(remaining, bracket.limit - previousLimit);
    if (bracketSize <= 0) break;
    tax += bracketSize * (bracket.rate / 100);
    remaining -= bracketSize;
    previousLimit = bracket.limit;
    if (remaining <= 0) break;
  }
  
  let algemene = TAX_CREDITS_2026.algemeneMax;
  if (grossIncome > TAX_CREDITS_2026.algemeneAfbouwStart) {
    algemene -= (grossIncome - TAX_CREDITS_2026.algemeneAfbouwStart) * (TAX_CREDITS_2026.algemeneAfbouwPercentage / 100);
    algemene = Math.max(0, algemene);
  }
  
  let arbeid = 0;
  if (grossIncome <= TAX_CREDITS_2026.arbeidLowThreshold) {
    arbeid = grossIncome * (TAX_CREDITS_2026.arbeidBuildRateLow / 100);
  } else {
    arbeid = TAX_CREDITS_2026.arbeidMax;
    if (grossIncome > TAX_CREDITS_2026.arbeidPhaseoutStart) {
      arbeid -= (grossIncome - TAX_CREDITS_2026.arbeidPhaseoutStart) * (TAX_CREDITS_2026.arbeidPhaseoutRate / 100);
      arbeid = Math.max(0, arbeid);
    }
  }
  
  const totalCredits = algemene + arbeid;
  const netTax = Math.max(0, tax - totalCredits);
  const netIncome = grossIncome - netTax;
  
  return { grossIncome, incomeTax: tax, credits: totalCredits, netTax, netIncome };
};

// Toeslagen Calculations (with inflation adjustment)
const berekenKindgebondenBudget = (toetsInkomen, aantalKinderen, fiscaalPartner, inflationFactor = 1) => {
  if (aantalKinderen === 0) return 0;
  const { KINDGEBONDEN_BUDGET } = TOESLAGEN_2026;
  const maxBedrag = KINDGEBONDEN_BUDGET.PER_KIND * aantalKinderen * inflationFactor;
  const drempel = fiscaalPartner ? KINDGEBONDEN_BUDGET.DREMPEL_PARTNER : KINDGEBONDEN_BUDGET.DREMPEL_ENKEL;
  if (toetsInkomen <= drempel) return maxBedrag;
  return Math.max(0, maxBedrag - (toetsInkomen - drempel) * KINDGEBONDEN_BUDGET.AFBOUW_PERC);
};

const berekenKinderopvangtoeslag = (toetsInkomen, opvangDetails, inflationFactor = 1) => {
  if (!opvangDetails || opvangDetails.length === 0) return 0;
  const schijf = KINDEROPVANG_SCHIJVEN.find(s => toetsInkomen >= s.van && toetsInkomen <= s.tot) || KINDEROPVANG_SCHIJVEN[KINDEROPVANG_SCHIJVEN.length - 1];
  const { percEerste, percVolgend } = schijf;
  const { MAX_UREN_MAAND, TYPES } = TOESLAGEN_2026.KINDEROPVANG;
  
  let totaal = 0;
  const gesorteerd = [...opvangDetails].sort((a, b) => (b.uren || 0) - (a.uren || 0));
  gesorteerd.forEach((opv, index) => {
    const urenMaand = Math.min(opv.uren || 0, MAX_UREN_MAAND);
    const urenJaar = urenMaand * 12;
    const maxPrijs = TYPES[opv.type] || 0;
    const perc = (index === 0) ? percEerste : percVolgend;
    totaal += urenJaar * maxPrijs * perc * inflationFactor;
  });
  return Math.round(totaal);
};

const berekenKinderbijslag = (leeftijden, inflationFactor = 1) => {
  if (!leeftijden || leeftijden.length === 0) return 0;
  const { KINDERBIJSLAG } = TOESLAGEN_2026;
  let totaalJaar = 0;
  leeftijden.forEach((leeftijd) => {
    let config = null;
    if (leeftijd >= 0 && leeftijd <= 5) config = KINDERBIJSLAG.LEEFTIJD_0_5;
    else if (leeftijd >= 6 && leeftijd <= 11) config = KINDERBIJSLAG.LEEFTIJD_6_11;
    else if (leeftijd >= 12 && leeftijd <= 17) config = KINDERBIJSLAG.LEEFTIJD_12_17;
    if (config) totaalJaar += config.kwartaal * 4 * inflationFactor;
  });
  return totaalJaar;
};

// Mortgage Calculation with Amortization
const calculateMortgageYear = ({ outstandingAmount, interestRate, remainingMonths }, yearsSinceStart) => {
  const monthlyRate = (interestRate / 100) / 12;
  
  if (!monthlyRate) {
    // Interest-free: simple amortization
    const monthlyPayment = outstandingAmount / remainingMonths;
    return {
      payment: monthlyPayment * 12,
      interest: 0,
      principal: monthlyPayment * 12,
      remainingBalance: Math.max(0, outstandingAmount - (monthlyPayment * 12 * yearsSinceStart))
    };
  }
  
  // Annuity calculation
  const monthlyPayment = outstandingAmount * (monthlyRate / (1 - Math.pow(1 + monthlyRate, -remainingMonths)));
  
  // Calculate balance after yearsSinceStart years
  let balance = outstandingAmount;
  let totalInterest = 0;
  
  for (let month = 0; month < Math.min(yearsSinceStart * 12, remainingMonths); month++) {
    const interest = balance * monthlyRate;
    const principal = monthlyPayment - interest;
    balance -= principal;
    if (month >= (yearsSinceStart - 1) * 12 && month < yearsSinceStart * 12) {
      totalInterest += interest;
    }
  }
  
  return {
    payment: monthlyPayment * 12,
    interest: totalInterest,
    principal: monthlyPayment * 12 - totalInterest,
    remainingBalance: Math.max(0, balance)
  };
};

const mortgagePaymentAnnual = ({ outstandingAmount, interestRate, remainingMonths }) => {
  return calculateMortgageYear({ outstandingAmount, interestRate, remainingMonths }, 1).payment;
};

// Main Cashflow Engine
const calculateAnnualCashflow = (year, items, assumptions) => {
  let grossIncome = 0;
  let totalExpenses = 0;
  let toeslagen = 0;
  let hypotheekrenteAftrek = 0; // Track deductible mortgage interest

  items.forEach(item => {
    if (!isActiveInYear(item, year)) return;

    // Housing (mortgage)
    if (item.type === 'expense' && item.category === 'housing' && item.metadata?.mortgage) {
      const mortgage = item.metadata.mortgage;
      const yearsActive = Math.max(0, year - item.startYear);
      const mortgageYear = calculateMortgageYear(mortgage, yearsActive + 1);
      
      totalExpenses += mortgageYear.payment;
      hypotheekrenteAftrek += mortgageYear.interest; // Only interest is deductible
      return;
    }

    // Kinderopvangtoeslag
    if (item.category === 'childcare' && item.metadata?.kinderen) {
      // Will be calculated after netIncome is known
      return;
    }

    // Kinderbijslag - will be calculated with inflation in second loop
    if (item.category === 'child-benefit' && item.metadata?.kinderenLeeftijden) {
      return; // Calculate after with inflation
    }

    // Kindgebonden budget
    if (item.category === 'child-budget' && item.metadata) {
      // Will be calculated after netIncome is known
      return;
    }

    const base = yearlyAmount(item.amount, item.frequency);

    if (item.type === 'income') {
      const yearsActive = Math.max(0, year - item.startYear);
      const grown = grow(base, item.growthRate || 0, yearsActive);
      grossIncome += grown;
    }

    if (item.type === 'expense') {
      const yearsActive = Math.max(0, year - item.startYear);
      const adjusted = item.adjustForInflation
        ? grow(base, assumptions.inflationRate || 0, yearsActive)
        : base;
      totalExpenses += adjusted;
    }
  });

  // Apply mortgage interest deduction to taxable income (Box 1 deduction)
  const taxableIncome = Math.max(0, grossIncome - hypotheekrenteAftrek);
  const taxResult = calculateDutchTax2026(taxableIncome);
  const netIncome = grossIncome - taxResult.netTax; // Net = gross - tax (on reduced taxable income)

  // Now calculate income-dependent toeslagen (based on net income)
  items.forEach(item => {
    if (!isActiveInYear(item, year)) return;
    
    // Calculate inflation factor for toeslagen (delayed by 1 year)
    const yearsActive = Math.max(0, year - item.startYear);
    const inflationYears = Math.max(0, yearsActive - 1); // 1 year lag
    const inflationFactor = Math.pow(1 + (assumptions.inflationRate || 0) / 100, inflationYears);
    
    if (item.category === 'childcare' && item.metadata?.kinderen) {
      toeslagen += berekenKinderopvangtoeslag(netIncome, item.metadata.kinderen, inflationFactor);
    }
    
    if (item.category === 'child-budget' && item.metadata) {
      toeslagen += berekenKindgebondenBudget(
        netIncome,
        item.metadata.aantalKinderen || 0,
        item.metadata.fiscaalPartner || false,
        inflationFactor
      );
    }
    
    if (item.category === 'child-benefit' && item.metadata?.kinderenLeeftijden) {
      toeslagen += berekenKinderbijslag(item.metadata.kinderenLeeftijden, inflationFactor);
    }
  });

  const totalAvailable = netIncome + toeslagen; // Total after-tax income including allowances
  const netSavings = totalAvailable - totalExpenses; // Actual savings

  return {
    year,
    grossIncome,
    taxableIncome, // Gross minus mortgage interest deduction
    netIncome,
    expenses: totalExpenses,
    savings: netSavings, // This includes the benefit of toeslagen
    toeslagen,
    hypotheekrenteAftrek,
    effectiveTaxRate: taxableIncome > 0 ? (taxResult.netTax / grossIncome * 100) : 0
  };
};

// Projections Builder
const buildProjections = ({ startYear, years, startNetWorth, items, assumptions, targetNetWorth }) => {
  const investmentRate = (assumptions.investmentReturn || 7) / 100;
  let netWorth = startNetWorth;
  const timeline = [];

  for (let i = 0; i < years; i++) {
    const year = startYear + i;
    const cashflow = calculateAnnualCashflow(year, items, assumptions);
    
    netWorth *= (1 + investmentRate);
    netWorth += cashflow.savings; // Toeslagen zitten al in savings (via netIncome)
    
    timeline.push({
      year,
      netWorth: Math.round(netWorth),
      cashflow
    });
  }

  const fireEntry = timeline.find(e => e.netWorth >= targetNetWorth);
  const fireYear = fireEntry ? fireEntry.year : null;
  const monthlySavings = timeline[0] ? timeline[0].cashflow.savings / 12 : 0; // savings bevat al toeslagen

  return { timeline, fireYear, yearsToFire: fireYear ? fireYear - startYear : null, monthlySavings };
};

// UI Helpers
const formatCurrency = (value) => `‚Ç¨${Math.round(value).toLocaleString('nl-NL')}`;

// Calculate display amounts for items
const getItemDisplayAmount = (item, assumptions = {}) => {
  if (item.category === 'housing' && item.metadata?.mortgage) {
    return formatCurrency(mortgagePaymentAnnual(item.metadata.mortgage));
  }
  
  if (item.category === 'child-benefit' && item.metadata?.kinderenLeeftijden) {
    return formatCurrency(berekenKinderbijslag(item.metadata.kinderenLeeftijden));
  }
  
  if (item.category === 'childcare' && item.metadata?.kinderen) {
    // Estimate with avg income of 40k net
    return formatCurrency(berekenKinderopvangtoeslag(40000, item.metadata.kinderen));
  }
  
  if (item.category === 'child-budget' && item.metadata) {
    // Estimate with avg income of 40k net
    return formatCurrency(berekenKindgebondenBudget(40000, item.metadata.aantalKinderen || 0, item.metadata.fiscaalPartner || false));
  }
  
  if (item.amount) {
    const yearly = yearlyAmount(item.amount, item.frequency);
    return formatCurrency(yearly);
  }
  
  return 'Automatisch';
};

/* ================================
   REACT COMPONENTS
   ================================ */

function KPICard({ label, value, icon = "üìä" }) {
  return (
    <div className="bg-white p-4 rounded-lg shadow">
      <div className="text-sm text-gray-600 mb-1">{icon} {label}</div>
      <div className="text-2xl font-bold text-primary">{value}</div>
    </div>
  );
}

function SimpleEditDialog({ item, onSave, onCancel }) {
  const [formData, setFormData] = useState(item || {});
  
  if (!item) return null;
  
  const updateField = (field, value) => {
    const updated = { ...formData, [field]: value };
    
    // Auto-initialize metadata when category changes
    if (field === 'category') {
      if (value === 'housing' && !updated.metadata?.mortgage) {
        updated.metadata = {
          mortgage: { outstandingAmount: 300000, interestRate: 4, remainingMonths: 360 }
        };
      } else if (value === 'child-benefit' && !updated.metadata?.kinderenLeeftijden) {
        updated.metadata = { kinderenLeeftijden: [] };
      } else if (value === 'childcare' && !updated.metadata?.kinderen) {
        updated.metadata = { kinderen: [] };
      } else if (value === 'child-budget' && !updated.metadata?.aantalKinderen) {
        updated.metadata = { aantalKinderen: 0, fiscaalPartner: false };
      }
    }
    
    setFormData(updated);
  };
  
  const handleSubmit = (e) => {
    e.preventDefault();
    onSave(formData);
  };
  
  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
      <div className="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
        <form onSubmit={handleSubmit}>
          <div className="p-6 border-b">
            <h2 className="text-xl font-semibold">
              {formData.id ? 'Bewerk' : 'Nieuw'} {formData.type === 'income' ? 'Inkomen' : 'Uitgave'}
            </h2>
          </div>
          
          <div className="p-6 space-y-4">
            {/* Name */}
            <div>
              <label className="block text-sm font-medium mb-1">Naam</label>
              <input
                type="text"
                value={formData.name || ''}
                onChange={(e) => updateField('name', e.target.value)}
                className="w-full px-3 py-2 border rounded-lg"
                required
              />
            </div>
            
            {/* Category */}
            <div>
              <label className="block text-sm font-medium mb-1">Categorie</label>
              <select
                value={formData.category || (formData.type === 'income' ? 'salary' : 'other')}
                onChange={(e) => updateField('category', e.target.value)}
                className="w-full px-3 py-2 border rounded-lg"
              >
                {formData.type === 'income' ? (
                  <>
                    <option value="salary">üíº Salaris</option>
                    <option value="child-benefit">üçº Kinderbijslag</option>
                    <option value="childcare">üë∂ Kinderopvangtoeslag</option>
                    <option value="child-budget">üë®‚Äçüë©‚Äçüëß Kindgebonden budget</option>
                    <option value="other-income">üí∞ Overig inkomen</option>
                  </>
                ) : (
                  <>
                    <option value="housing">üè† Wonen (hypotheek)</option>
                    <option value="other">üõí Overige uitgaven</option>
                  </>
                )}
              </select>
            </div>
            
            {/* Amount (not for special categories) */}
            {!['housing', 'child-benefit', 'childcare', 'child-budget'].includes(formData.category) && (
              <>
                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <label className="block text-sm font-medium mb-1">Bedrag (‚Ç¨)</label>
                    <input
                      type="number"
                      value={formData.amount || 0}
                      onChange={(e) => updateField('amount', parseFloat(e.target.value) || 0)}
                      className="w-full px-3 py-2 border rounded-lg"
                      min="0"
                      step="0.01"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium mb-1">Frequentie</label>
                    <select
                      value={formData.frequency || 'yearly'}
                      onChange={(e) => updateField('frequency', e.target.value)}
                      className="w-full px-3 py-2 border rounded-lg"
                    >
                      <option value="monthly">Per maand</option>
                      <option value="yearly">Per jaar</option>
                    </select>
                  </div>
                </div>
                
                {formData.type === 'income' && (
                  <div>
                    <label className="block text-sm font-medium mb-1">Groei per jaar (%)</label>
                    <input
                      type="number"
                      value={formData.growthRate || 0}
                      onChange={(e) => updateField('growthRate', parseFloat(e.target.value) || 0)}
                      className="w-full px-3 py-2 border rounded-lg"
                      min="0"
                      max="100"
                      step="0.1"
                    />
                  </div>
                )}
                
                {formData.type === 'expense' && (
                  <div className="flex items-center gap-2">
                    <input
                      type="checkbox"
                      checked={formData.adjustForInflation || false}
                      onChange={(e) => updateField('adjustForInflation', e.target.checked)}
                      className="w-4 h-4"
                    />
                    <label className="text-sm">Pas aan voor inflatie</label>
                  </div>
                )}
              </>
            )}
            
            {/* Hypotheek specifiek */}
            {formData.category === 'housing' && (
              <div className="bg-blue-50 p-4 rounded-lg space-y-3">
                <h3 className="font-semibold">Hypotheek details</h3>
                <div className="grid grid-cols-2 gap-3">
                  <div>
                    <label className="block text-xs mb-1">Restschuld (‚Ç¨)</label>
                    <input
                      type="number"
                      value={formData.metadata?.mortgage?.outstandingAmount || 0}
                      onChange={(e) => updateField('metadata', {
                        ...formData.metadata,
                        mortgage: { ...formData.metadata?.mortgage, outstandingAmount: parseFloat(e.target.value) || 0 }
                      })}
                      className="w-full px-2 py-1 border rounded text-sm"
                      min="0"
                    />
                  </div>
                  <div>
                    <label className="block text-xs mb-1">Rente (%)</label>
                    <input
                      type="number"
                      value={formData.metadata?.mortgage?.interestRate || 0}
                      onChange={(e) => updateField('metadata', {
                        ...formData.metadata,
                        mortgage: { ...formData.metadata?.mortgage, interestRate: parseFloat(e.target.value) || 0 }
                      })}
                      className="w-full px-2 py-1 border rounded text-sm"
                      min="0"
                      step="0.1"
                    />
                  </div>
                  <div>
                    <label className="block text-xs mb-1">Looptijd (maanden)</label>
                    <input
                      type="number"
                      value={formData.metadata?.mortgage?.remainingMonths || 360}
                      onChange={(e) => updateField('metadata', {
                        ...formData.metadata,
                        mortgage: { ...formData.metadata?.mortgage, remainingMonths: parseInt(e.target.value) || 360 }
                      })}
                      className="w-full px-2 py-1 border rounded text-sm"
                      min="1"
                    />
                  </div>
                </div>
              </div>
            )}
            
            {/* Kinderbijslag specifiek */}
            {formData.category === 'child-benefit' && (
              <div className="bg-purple-50 p-4 rounded-lg space-y-3">
                <h3 className="font-semibold">Kinderbijslag - Leeftijden kinderen</h3>
                <p className="text-xs text-gray-600">Voeg kinderen toe (0-17 jaar)</p>
                <div className="space-y-2">
                  {(formData.metadata?.kinderenLeeftijden || []).map((leeftijd, i) => (
                    <div key={i} className="flex gap-2 items-center">
                      <input
                        type="number"
                        value={leeftijd}
                        onChange={(e) => {
                          const newLeeftijden = [...(formData.metadata?.kinderenLeeftijden || [])];
                          newLeeftijden[i] = parseInt(e.target.value) || 0;
                          updateField('metadata', { ...formData.metadata, kinderenLeeftijden: newLeeftijden });
                        }}
                        className="flex-1 px-2 py-1 border rounded text-sm"
                        min="0"
                        max="17"
                      />
                      <button
                        type="button"
                        onClick={() => {
                          const newLeeftijden = [...(formData.metadata?.kinderenLeeftijden || [])];
                          newLeeftijden.splice(i, 1);
                          updateField('metadata', { ...formData.metadata, kinderenLeeftijden: newLeeftijden });
                        }}
                        className="px-2 py-1 bg-red-100 text-red-700 rounded text-sm"
                      >
                        Verwijder
                      </button>
                    </div>
                  ))}
                </div>
                <button
                  type="button"
                  onClick={() => {
                    const newLeeftijden = [...(formData.metadata?.kinderenLeeftijden || []), 0];
                    updateField('metadata', { ...formData.metadata, kinderenLeeftijden: newLeeftijden });
                  }}
                  className="px-3 py-1 bg-purple-600 text-white rounded text-sm"
                >
                  + Kind toevoegen
                </button>
              </div>
            )}
            
            {/* Kinderopvangtoeslag specifiek */}
            {formData.category === 'childcare' && (
              <div className="bg-teal-50 p-4 rounded-lg space-y-3">
                <h3 className="font-semibold">Kinderopvangtoeslag - Kinderen details</h3>
                <p className="text-xs text-gray-600">Voeg kinderen toe met uren per maand en type opvang</p>
                <div className="space-y-2">
                  {(formData.metadata?.kinderen || []).map((kind, i) => (
                    <div key={i} className="bg-white p-2 rounded border space-y-2">
                      <div className="flex justify-between items-center">
                        <span className="text-sm font-medium">Kind {i + 1}</span>
                        <button
                          type="button"
                          onClick={() => {
                            const newKinderen = [...(formData.metadata?.kinderen || [])];
                            newKinderen.splice(i, 1);
                            updateField('metadata', { ...formData.metadata, kinderen: newKinderen });
                          }}
                          className="px-2 py-1 bg-red-100 text-red-700 rounded text-xs"
                        >
                          Verwijder
                        </button>
                      </div>
                      <div className="grid grid-cols-2 gap-2">
                        <div>
                          <label className="block text-xs mb-1">Uren/maand (max 230)</label>
                          <input
                            type="number"
                            value={kind.uren || 0}
                            onChange={(e) => {
                              const newKinderen = [...(formData.metadata?.kinderen || [])];
                              newKinderen[i] = { ...newKinderen[i], uren: parseInt(e.target.value) || 0 };
                              updateField('metadata', { ...formData.metadata, kinderen: newKinderen });
                            }}
                            className="w-full px-2 py-1 border rounded text-sm"
                            min="0"
                            max="230"
                          />
                        </div>
                        <div>
                          <label className="block text-xs mb-1">Type opvang</label>
                          <select
                            value={kind.type || 'dagopvang'}
                            onChange={(e) => {
                              const newKinderen = [...(formData.metadata?.kinderen || [])];
                              newKinderen[i] = { ...newKinderen[i], type: e.target.value };
                              updateField('metadata', { ...formData.metadata, kinderen: newKinderen });
                            }}
                            className="w-full px-2 py-1 border rounded text-sm"
                          >
                            <option value="dagopvang">Dagopvang</option>
                            <option value="bso">BSO</option>
                            <option value="gastouder">Gastouder</option>
                          </select>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
                <button
                  type="button"
                  onClick={() => {
                    const newKinderen = [...(formData.metadata?.kinderen || []), { uren: 0, type: 'dagopvang' }];
                    updateField('metadata', { ...formData.metadata, kinderen: newKinderen });
                  }}
                  className="px-3 py-1 bg-teal-600 text-white rounded text-sm"
                >
                  + Kind toevoegen
                </button>
              </div>
            )}
            
            {/* Kindgebonden budget specifiek */}
            {formData.category === 'child-budget' && (
              <div className="bg-pink-50 p-4 rounded-lg space-y-3">
                <h3 className="font-semibold">Kindgebonden budget</h3>
                <div>
                  <label className="block text-sm mb-1">Aantal kinderen</label>
                  <input
                    type="number"
                    value={formData.metadata?.aantalKinderen || 0}
                    onChange={(e) => updateField('metadata', {
                      ...formData.metadata,
                      aantalKinderen: parseInt(e.target.value) || 0
                    })}
                    className="w-full px-3 py-2 border rounded-lg"
                    min="0"
                  />
                </div>
                <div className="flex items-center gap-2">
                  <input
                    type="checkbox"
                    checked={formData.metadata?.fiscaalPartner || false}
                    onChange={(e) => updateField('metadata', {
                      ...formData.metadata,
                      fiscaalPartner: e.target.checked
                    })}
                    className="w-4 h-4"
                  />
                  <label className="text-sm">Fiscaal partner</label>
                </div>
              </div>
            )}
            
            {/* Start/End Year */}
            <div className="grid grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium mb-1">Startjaar</label>
                <input
                  type="number"
                  value={formData.startYear || new Date().getFullYear()}
                  onChange={(e) => updateField('startYear', parseInt(e.target.value))}
                  className="w-full px-3 py-2 border rounded-lg"
                  min="2020"
                  max="2100"
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">Eindjaar (optioneel)</label>
                <input
                  type="number"
                  value={formData.endYear || ''}
                  onChange={(e) => updateField('endYear', e.target.value ? parseInt(e.target.value) : null)}
                  className="w-full px-3 py-2 border rounded-lg"
                  min="2020"
                  max="2100"
                  placeholder="Onbeperkt"
                />
              </div>
            </div>
          </div>
          
          <div className="p-6 border-t flex gap-3 justify-end">
            <button
              type="button"
              onClick={onCancel}
              className="px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"
            >
              Annuleren
            </button>
            <button
              type="submit"
              className="px-4 py-2 bg-primary text-white rounded hover:bg-primary-dark"
            >
              Opslaan
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}

function App() {
  const startYear = new Date().getFullYear();

  const [items, setItems] = useState([
    { 
      id: 1, 
      name: 'Salaris', 
      type: 'income', 
      amount: 80000, 
      frequency: 'yearly', 
      growthRate: 2, 
      startYear,
      category: 'salary'
    },
    { 
      id: 2, 
      name: 'Levensonderhoud', 
      type: 'expense', 
      amount: 2500, 
      frequency: 'monthly', 
      adjustForInflation: true, 
      startYear,
      category: 'other'
    },
    {
      id: 3,
      name: 'Hypotheek',
      type: 'expense',
      category: 'housing',
      startYear,
      metadata: {
        mortgage: { 
          outstandingAmount: 300000, 
          interestRate: 4, 
          remainingMonths: 360 
        }
      }
    },
    {
      id: 4,
      name: 'Kinderbijslag',
      type: 'income',
      category: 'child-benefit',
      startYear,
      metadata: { 
        kinderenLeeftijden: [3, 6] 
      }
    }
  ]);

  const [currentNetWorth, setCurrentNetWorth] = useState(20000);
  const [targetNetWorth, setTargetNetWorth] = useState(1500000);
  const [editingItem, setEditingItem] = useState(null);
  const [showAddDialog, setShowAddDialog] = useState(false);

  const assumptions = { inflationRate: 2, investmentReturn: 7 };

  const projections = buildProjections({
    startYear,
    years: 50,
    startNetWorth: currentNetWorth,
    items,
    assumptions,
    targetNetWorth
  });

  const handleDelete = (id) => {
    if (confirm('Weet je zeker dat je dit item wilt verwijderen?')) {
      setItems(items.filter(item => item.id !== id));
    }
  };

  const handleEdit = (item) => {
    setEditingItem(item);
  };

  const handleSave = (updatedItem) => {
    if (updatedItem.id) {
      setItems(items.map(item => item.id === updatedItem.id ? updatedItem : item));
    } else {
      setItems([...items, { ...updatedItem, id: Date.now() }]);
    }
    setEditingItem(null);
    setShowAddDialog(false);
  };

  const handleAdd = (type) => {
    setEditingItem({
      type,
      name: '',
      amount: 0,
      frequency: 'yearly',
      startYear,
      category: type === 'income' ? 'salary' : 'other'
    });
    setShowAddDialog(true);
  };

  return (
    <div className="p-6 max-w-6xl mx-auto space-y-6">
      <div className="bg-white p-6 rounded-lg shadow">
        <h1 className="text-3xl font-bold text-primary mb-2">Financi√´le Planning Tool</h1>
        <p className="text-gray-600">Plan je financi√´le toekomst met inzicht in vermogen, toeslagen en FIRE</p>
      </div>

      <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
        <KPICard 
          icon="üí∞" 
          label="Maandelijks saldo" 
          value={formatCurrency(projections.monthlySavings)} 
        />
        <KPICard 
          icon="üéØ" 
          label="Vermogensdoel" 
          value={formatCurrency(targetNetWorth)} 
        />
        <KPICard 
          icon="üî•" 
          label="FIRE Jaar" 
          value={projections.fireYear || '‚Äî'} 
        />
        <KPICard 
          icon="üéÅ" 
          label="Toeslagen p/j" 
          value={formatCurrency(projections.timeline?.[0]?.cashflow?.toeslagen ?? 0)} 
        />
      </div>

      <div className="bg-white p-6 rounded-lg shadow">
        <div className="flex justify-between items-center mb-4">
          <h2 className="text-xl font-semibold">Inkomsten & Uitgaven</h2>
          <div className="flex gap-2">
            <button 
              onClick={() => handleAdd('income')}
              className="px-4 py-2 bg-primary text-white rounded hover:bg-primary-dark transition"
            >
              + Inkomen
            </button>
            <button 
              onClick={() => handleAdd('expense')}
              className="px-4 py-2 bg-secondary text-white rounded hover:bg-blue-700 transition"
            >
              + Uitgave
            </button>
          </div>
        </div>
        
        <div className="space-y-3">
          {items.map(item => (
            <div key={item.id} className="flex justify-between items-center p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
              <div className="flex-1">
                <div className="flex items-center gap-2 mb-1">
                  <span className="text-xl">
                    {item.type === 'income' ? 'üí∞' : 'üí∏'}
                  </span>
                  <span className="font-medium text-lg">{item.name}</span>
                  {item.category === 'housing' && <span className="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">üè† Hypotheek</span>}
                  {item.category === 'child-benefit' && <span className="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">üçº Kinderbijslag</span>}
                  {item.category === 'childcare' && <span className="text-xs bg-teal-100 text-teal-800 px-2 py-1 rounded">üë∂ Kinderopvang</span>}
                  {item.category === 'child-budget' && <span className="text-xs bg-pink-100 text-pink-800 px-2 py-1 rounded">üë®‚Äçüë©‚Äçüëß Kindgebonden budget</span>}
                </div>
                
                <div className="flex items-center gap-4 text-sm text-gray-600">
                  <span className="font-semibold text-primary">
                    {getItemDisplayAmount(item, assumptions)}/jaar
                  </span>
                  
                  {item.category === 'child-benefit' && item.metadata?.kinderenLeeftijden && (
                    <span>‚Ä¢ {item.metadata.kinderenLeeftijden.length} {item.metadata.kinderenLeeftijden.length === 1 ? 'kind' : 'kinderen'} (leeftijd: {item.metadata.kinderenLeeftijden.join(', ')})</span>
                  )}
                  
                  {item.category === 'childcare' && item.metadata?.kinderen && (
                    <span>‚Ä¢ {item.metadata.kinderen.length} {item.metadata.kinderen.length === 1 ? 'kind' : 'kinderen'}</span>
                  )}
                  
                  {item.category === 'child-budget' && item.metadata?.aantalKinderen > 0 && (
                    <span>‚Ä¢ {item.metadata.aantalKinderen} {item.metadata.aantalKinderen === 1 ? 'kind' : 'kinderen'}</span>
                  )}
                  
                  {item.category === 'housing' && item.metadata?.mortgage && (
                    <span>‚Ä¢ Restschuld: {formatCurrency(item.metadata.mortgage.outstandingAmount)} @ {item.metadata.mortgage.interestRate}%</span>
                  )}
                  
                  {item.growthRate > 0 && (
                    <span>‚Ä¢ +{item.growthRate}% groei/jaar</span>
                  )}
                  
                  {item.adjustForInflation && (
                    <span>‚Ä¢ Inflatie-gecorrigeerd</span>
                  )}
                  
                  <span className="text-gray-400">‚Ä¢ Vanaf {item.startYear}</span>
                </div>
              </div>
              
              <div className="flex gap-2 ml-4">
                <button 
                  onClick={() => handleEdit(item)}
                  className="px-3 py-1 text-sm bg-gray-200 hover:bg-gray-300 rounded transition"
                >
                  ‚úèÔ∏è Bewerk
                </button>
                <button 
                  onClick={() => handleDelete(item.id)}
                  className="px-3 py-1 text-sm bg-red-100 hover:bg-red-200 text-red-700 rounded transition"
                >
                  üóëÔ∏è Verwijder
                </button>
              </div>
            </div>
          ))}
          
          {items.length === 0 && (
            <div className="text-center py-8 text-gray-500">
              <p className="mb-2">Nog geen items toegevoegd</p>
              <p className="text-sm">Klik op "+ Inkomen" of "+ Uitgave" om te beginnen</p>
            </div>
          )}
        </div>
      </div>

      <div className="bg-white p-6 rounded-lg shadow">
        <h2 className="text-xl font-semibold mb-4">Vermogensontwikkeling (eerste 10 jaar)</h2>
        
        {projections.fireYear && (
          <div className="mb-4 p-3 bg-green-50 border-l-4 border-green-500 rounded">
            <p className="text-green-800">
              üéâ Je bereikt je vermogensdoel in <strong>{projections.fireYear}</strong> (over {projections.yearsToFire} jaar)
            </p>
          </div>
        )}
        
        <div className="space-y-2">
          {projections.timeline.slice(0, 10).map(y => (
            <div key={y.year} className="flex justify-between items-center text-sm">
              <span className="font-medium">{y.year}</span>
              <div className="flex items-center gap-4">
                <span className="text-gray-600">
                  Vermogen: <span className="font-semibold">{formatCurrency(y.netWorth)}</span>
                </span>
                {y.cashflow.toeslagen > 0 && (
                  <span className="text-green-600 text-xs">
                    +{formatCurrency(y.cashflow.toeslagen)} toeslagen
                  </span>
                )}
              </div>
            </div>
          ))}
        </div>
      </div>
      
      {/* Edit Dialog */}
      {(editingItem || showAddDialog) && (
        <SimpleEditDialog
          item={editingItem}
          onSave={handleSave}
          onCancel={() => {
            setEditingItem(null);
            setShowAddDialog(false);
          }}
        />
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>

</body>
</html>
